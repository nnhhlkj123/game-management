<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Game Form</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="container mt-4">
	<h1 th:text="${game.id != null} ? 'Edit Game' : 'Register New Game'"></h1>

	<form method="post" th:action="@{/games/save}" th:object="${game}" onsubmit="return validateForm()">
		<div class="mb-3">
			<label>ID</label>
			<input type="text" th:field="*{id}" class="form-control" th:readonly="${game.id != null}" required />
		</div>

		<div class="mb-3">
			<label>Category</label>
			<select th:field="*{category}" class="form-select" required>
				<option value="">-- Select Category --</option>
				<option value="ADVENTURE">Adventure</option>
				<option value="ACTION">Action</option>
				<option value="RPG">RPG</option>
			</select>
		</div>

		<div class="mb-3">
			<label>Names (Multilingual)</label>
			<div id="nameFields">
				<div th:each="name, stat : *{names}">
					<div class="row mb-2">
						<div class="col-md-4">
							<select th:field="*{names[__${stat.index}__].language}" class="form-select" required>
								<option value="EN">English</option>
								<option value="KO">Korean</option>
								<option value="JA">Japanese</option>
							</select>
						</div>
						<div class="col-md-6">
							<input type="text" th:field="*{names[__${stat.index}__].value}" class="form-control"
								placeholder="Name" required />
						</div>
						<div class="col-md-2">
							<button type="button" class="btn btn-danger" onclick="removeRow(this)">X</button>
						</div>
					</div>
				</div>
			</div>
			<button type="button" class="btn btn-secondary" onclick="addNameField()">Add Language</button>
		</div>

		<button type="submit" class="btn btn-primary">Save</button>
		<a href="/games" class="btn btn-secondary">Cancel</a>
	</form>

	<script>
		let index = document.querySelectorAll('#nameFields .row').length;

		function addNameField() {
			const container = document.getElementById('nameFields');
			const row = document.createElement('div');
			row.className = "row mb-2";
			row.innerHTML = `
            <div class="col-md-4">
                <select name="names[${index}].language" class="form-select" required>
                    <option value="EN">English</option>
                    <option value="KO">Korean</option>
                    <option value="JA">Japanese</option>
                </select>
            </div>
            <div class="col-md-6">
                <input type="text" name="names[${index}].value" class="form-control" placeholder="Name" required />
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-danger" onclick="removeRow(this)">X</button>
            </div>
        `;
			container.appendChild(row);
			index++;
		}

		function removeRow(button) {
			button.closest('.row').remove();
		}

		// ✅ Hàm kiểm tra trước khi submit
		function validateForm() {
			const nameFields = document.querySelectorAll('#nameFields .row');
			if (nameFields.length === 0) {
				alert('Vui lòng thêm ít nhất một tên game (Names - Multilingual) trước khi lưu.');
				return false; // Ngăn form gửi đi
			}
			return true;
		}
	</script>
	
</body>

</html>