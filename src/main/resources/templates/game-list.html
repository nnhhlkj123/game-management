<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Game List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
    <h1>Game List</h1>

    <form class="row mb-3" method="get" th:action="@{/games}">
        <div class="col-md-3">
            <input type="text" name="keyword" class="form-control" placeholder="Search by name"
                   th:value="${currentKeyword}" />
        </div>
        <div class="col-md-3">
            <select name="category" class="form-select">
                <option value="" th:selected="${currentCategory == null}">All Categories</option>
                <option value="ADVENTURE" th:selected="${currentCategory == 'ADVENTURE'}">Adventure</option>
                <option value="ACTION" th:selected="${currentCategory == 'ACTION'}">Action</option>
                <option value="RPG" th:selected="${currentCategory == 'RPG'}">RPG</option>
            </select>
        </div>
        <div class="col-md-2">
            <!-- Dropdown chọn số lượng bản ghi/trang -->
            <select name="size" class="form-select" onchange="this.form.submit()">
                <option th:value="5" th:selected="${gamePage.size == 5}">5 / page</option>
                <option th:value="10" th:selected="${gamePage.size == 10}">10 / page</option>
                <option th:value="20" th:selected="${gamePage.size == 20}">20 / page</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
        <div class="col-md-2 text-end">
            <a href="/games/register" class="btn btn-success">Register New Game</a>
        </div>
    </form>

    <form id="deleteForm" method="post" th:action="@{/games/delete}">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th><input type="checkbox" onclick="toggle(this)" /></th>
                    <th>ID</th>
                    <th>Category</th>
                    <th>Names</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="game : ${gamePage.content}">
                    <td><input type="checkbox" name="ids" th:value="${game.id}" /></td>
                    <td th:text="${game.id}"></td>
                    <td th:text="${game.category}"></td>
                    <td>
                        <ul>
                            <li th:each="name : ${game.nameList}"
                                th:text="${name.language + ': ' + name.value}"></li>
                        </ul>
                    </td>
                    <td>
                        <a th:href="@{'/games/register'(id=${game.id})}" class="btn btn-sm btn-primary">Edit</a>
                    </td>
                </tr>
            </tbody>
        </table>
        <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete Selected</button>
    </form>

    <!-- Pagination controls -->
    <nav th:if="${gamePage.totalPages > 1}" aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${gamePage.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/games(page=${gamePage.number - 1}, size=${gamePage.size}, category=${currentCategory}, keyword=${currentKeyword})}">
                    Previous
                </a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, gamePage.totalPages - 1)}"
                th:classappend="${i == gamePage.number} ? 'active'">
                <a class="page-link"
                   th:href="@{/games(page=${i}, size=${gamePage.size}, category=${currentCategory}, keyword=${currentKeyword})}"
                   th:text="${i + 1}">1</a>
            </li>
            <li class="page-item" th:classappend="${gamePage.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/games(page=${gamePage.number + 1}, size=${gamePage.size}, category=${currentCategory}, keyword=${currentKeyword})}">
                    Next
                </a>
            </li>
        </ul>
        <div class="text-center mt-2">
            <small th:text="'Page ' + (${gamePage.number} + 1) + ' of ' + ${gamePage.totalPages}"></small>
        </div>
    </nav>

    <script>
        function toggle(source) {
            const checkboxes = document.querySelectorAll('input[name="ids"]');
            checkboxes.forEach(cb => cb.checked = source.checked);
        }

        function confirmDelete() {
            const selected = document.querySelectorAll('input[name="ids"]:checked');
            if (selected.length === 0) {
                alert("Vui lòng chọn game cần xóa.");
                return;
            }

            const confirmResult = confirm("Bạn có chắc chắn muốn xóa?");
            if (confirmResult) {
                document.getElementById("deleteForm").submit();
            }
        }
    </script>
</body>
</html>